webpackJsonp([1],{"9M+g":function(e,t){},Jmt5:function(e,t){},M93x:function(e,t,r){"use strict";var n=r("YK0F"),o=r("VU/8"),a=o(null,n.a,null,null,null);t.a=a.exports},MQ71:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("7+uW"),o=r("M93x"),a=r("YaEn"),i=r("Jmt5"),s=(r.n(i),r("9M+g"));r.n(s);n.a.config.productionTip=!1,new n.a({el:"#app",router:a.a,template:"<App/>",components:{App:o.a}})},NTRc:function(e,t,r){"use strict";var n=r("//Fk"),o=r.n(n),a=r("mvHQ"),i=r.n(a),s=r("woOf"),l=r.n(s),u={start_week:0,end_week:void 0,type:void 0,value:{day:void 0,time:void 0,duration:void 0,status_id:void 0,location_id:void 0},highlighted:!1};t.a={data:function(){return{total_weeks:50,types:[{id:"day_of_week"},{id:"time_of_day"},{id:"status"},{id:"location"}],statuses:[{id:1,name:"Active"},{id:2,name:"Passive"},{id:3,name:"One More"}],locations:[{id:1,name:"Room 1"},{id:2,name:"Room 2"},{id:3,name:"Room 3"}],rules:[{id:1,type:"day_of_week",start_week:20,end_week:39,value:{day:"FRI"},highlighted:!1},{id:2,type:"day_of_week",start_week:40,value:{day:"WED"},highlighted:!1},{id:3,type:"time_of_day",start_week:10,value:{time:"10:00",duration:60},highlighted:!1},{id:4,type:"status",start_week:10,value:{status_id:1},highlighted:!1},{id:5,type:"location",start_week:10,value:{location_id:1},highlighted:!1}],autoincrementIndex:0,form:l()({},u),error:void 0,loading:!1,showPreliminary:!0,notes:[]}},computed:{rulesByType:function(){var e=this,t={};return this.rules.forEach(function(r){r=l()({},r),t.hasOwnProperty(r.type)||(t[r.type]=[]),"day_of_week"===r.type?r.note=r.value.day:"time_of_day"===r.type?r.note=r.value.time+" "+r.value.duration+"min":"status"===r.type?r.note=(e.statuses.find(function(e){return e.id===r.value.status_id})||{}).name:"location"===r.type?r.note=(e.locations.find(function(e){return e.id===r.value.location_id})||{}).name:r.note="",t[r.type].push(r)}),t},rows:function(){var e=this,t=[];return this.types.forEach(function(r){t.push(l()({},r,{rules:e.rulesByType[r.id]}))}),t}},methods:{getNextIndex:function(){return 0===this.autoincrementIndex&&(this.autoincrementIndex=this.rules.reduce(function(e,t){return Math.max(e,t.id)},0)),++this.autoincrementIndex},getRuleStyle:function(e){return{left:Math.floor(e.start_week/this.total_weeks*100)+"%",width:Math.floor(((void 0===e.end_week?this.total_weeks-1:e.end_week)-e.start_week+1)/this.total_weeks*100)+"%"}},valuesEqual:function(e,t){return e.type===t.type&&i()(e.value)===i()(t.value)},submit:function(){this.error=void 0;var e=void 0,t=void 0,r=void 0;try{if(e=Math.floor(this.form.start_week),isNaN(e)||e<0||e>this.total_weeks)throw new Error("Start week field is incorrect");if(""!==this.form.end_week&&void 0!==this.form.end_week&&(t=Math.floor(this.form.end_week),console.log(this.form.end_week),isNaN(t)||t<0||t>this.total_weeks))throw new Error("End week field is incorrect");if(void 0!==e&&void 0!==t&&t<e)throw new Error("End week must be greater than the start week");if(r=this.form.type,!this.types.find(function(e){return e.id===r}))throw new Error("Rule type is not supported")}catch(e){return void(this.error=e.message)}var n={};"day_of_week"===r?n.day=this.form.value.day:"time_of_day"===r?(n.time=this.form.value.time,n.duration=this.form.value.duration):"status"===r?n.status_id=this.form.value.status_id:"location"===r&&(n.location_id=this.form.value.location_id);var o={type:r,start_week:e,end_week:t,value:n};this.processNewRule(o)},reset:function(){this.form=l()({},u),this.error=void 0},processNewRule:function(e){var t=this,r=void 0,n=void 0,a=function(e){return function(){return new o.a(function(t,r){return setTimeout(t,e||1e3)})}};o.a.resolve().then(function(){t.loading=!0,t.notes=[]}).then(a()).then(function(){for(var r=0,n=0;n<t.rules.length;n++){var o=t.rules[n];o.type===e.type&&o.start_week>=e.start_week&&(void 0===e.end_week||void 0!==e.end_week&&void 0!==o.end_week&&o.end_week<=e.end_week)&&(o.highlighted=!0,r++)}t.notes.push("1. Select all rules that are covered by the new rule - "+r+" rules selected")}).then(a()).then(function(){for(var e=0,r=t.rules.length-1;r>=0;r--){t.rules[r].highlighted&&(t.rules.splice(r,1),e++)}t.notes.push("2. Delete covered rules - "+e+" rules deleted")}).then(a()).then(function(){r=t.rules.find(function(t){return t.type===e.type&&t.start_week<=e.start_week&&(void 0===t.end_week||t.end_week>=e.start_week)}),r&&(r.highlighted=!0),t.notes.push("3. Select the rule1 that covers new rule start_week - "+(r?"found #"+r.id+" ["+r.start_week+","+r.end_week+"]":"not found"))}).then(a()).then(function(){n=void 0===e.end_week?t.rules.find(function(t){return t.type===e.type&&void 0===t.end_week}):t.rules.find(function(t){return t.type===e.type&&t.start_week<=e.end_week&&(void 0===t.end_week||t.end_week>=e.end_week)}),n&&(n.highlighted=!0),t.notes.push("4. Select the rule2 that covers new rule end_week - "+(n?"found #"+n.id+" ["+n.start_week+","+n.end_week+"]":"not found"))}).then(a()).then(function(){var n=void 0;r&&void 0!==e.end_week&&(void 0===r.end_week||r.end_week>e.end_week)&&(n=l()({},r),n.id=t.getNextIndex(),n.start_week=e.end_week+1,t.rules.push(n)),t.notes.push("5. Check if rule1.end_week is after the rule.end_week and clone it after rule.end_week - "+(n?"cloned #"+n.id+" ["+n.start_week+","+n.end_week+"]":"no cloned rule"))}).then(a()).then(function(){var n="rule1 does not exist";if(r)if(r.start_week<e.start_week)r.end_week=e.start_week-1,n=" end_week set to "+r.end_week;else if(r.start_week===e.start_week){var o=t.rules.findIndex(function(e){return e.id===r.id});(0===o||o>0)&&(t.rules.splice(o,1),n="rule1 deleted")}t.notes.push("6. Move the end of the rule1 to be before the rule.start_week - "+n)}).then(a()).then(function(){var o="rule2 does not exist";if(n&&(o="rule2 is equal to rule1, no change",(!r||n!==r)&&(o="no change in rule2",void 0!==e.end_week&&n.start_week<=e.end_week&&(n.start_week=e.end_week+1,o="start_week set to "+n.start_week,n.start_week>n.end_week)))){var a=t.rules.findIndex(function(e){return e.id===n.id});(0===a||a>0)&&(t.rules.splice(a,1),o="rule2 deleted")}t.notes.push("7. Move the begining of rule2 to be after rule.end_week - "+o)}).then(a()).then(function(){e.id=t.getNextIndex(),t.rules.push(e),t.notes.push("8. Create new rule - #"+e.id+" ["+e.start_week+","+e.end_week+"]")}).then(a()).then(function(){t.notes.push("9. Merge consistent rules"),t.rules.sort(function(e,t){return e.start_week-t.start_week}),t.types.forEach(function(e){for(var r=t.rules.filter(function(t){return t.type===e.id}),n=1;n<r.length;n++)!function(e){var o=r[e-1],a=r[e];if(o.end_week===a.start_week-1&&t.valuesEqual(o,a)){o.end_week=a.end_week;var i=t.rules.findIndex(function(e){return e.id===a.id});(0===i||i>0)&&(t.rules.splice(i,1),r.splice(e,1),e--)}n=e}(n)})}).then(a()).then(function(){t.notes.push("10. Complete")}).then(a()).then(function(){t.rules.forEach(function(e){e.highlighted=!1}),t.loading=!1})}}}},YK0F:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement;return(e._self._c||t)("router-view")},o=[],a={render:n,staticRenderFns:o};t.a=a},YaEn:function(e,t,r){"use strict";var n=r("7+uW"),o=r("/ocq"),a=r("pW4T");n.a.use(o.a),t.a=new o.a({mode:"history",routes:[{path:"/",name:"RulesTest",component:a.a}]})},pW4T:function(e,t,r){"use strict";function n(e){r("MQ71")}var o=r("NTRc"),a=r("xxNb"),i=r("VU/8"),s=n,l=i(o.a,a.a,s,"data-v-71818264",null);t.a=l.exports},xxNb:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[r("h3",[e._v("Timeblock Rules Test")]),e._v(" "),e._l(e.rows,function(t){return r("div",{staticClass:"card mb-3"},[r("div",{staticClass:"card-body"},[r("h5",{staticClass:"card-title"},[e._v(e._s(t.id))]),e._v(" "),r("div",{staticClass:"bar"},[r("div",{staticClass:"bar-grid"},e._l(e.total_weeks,function(e){return r("div")})),e._v(" "),r("transition-group",{staticClass:"bar-content",attrs:{name:"slide",mode:"out-in"}},e._l(t.rules,function(t){return r("div",{key:t.id,staticClass:"bar-rule",class:{"-highlighted":t.highlighted},style:e.getRuleStyle(t)},[r("div",{staticClass:"bar-rule-inner"},[e._v(e._s(t.note))])])})),e._v(" "),r("transition",{attrs:{name:"slide"}},[e.showPreliminary&&e.form.type===t.id?r("div",{staticClass:"bar-rule -preliminary",style:e.getRuleStyle(e.form)},[r("div",{staticClass:"bar-rule-inner"})]):e._e()])],1)])])}),e._v(" "),r("h3",[e._v("Add New Rule")]),e._v(" "),e.error?r("div",{staticClass:"alert alert-danger mb-3"},[e._v(e._s(e.error))]):e._e(),e._v(" "),r("div",{staticClass:"card mb-3"},[r("div",{staticClass:"card-body"},[r("form",{on:{submit:function(t){t.preventDefault(),e.submit(t)}}},[r("div",{staticClass:"row"},[r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formStartWeek"}},[e._v("Start Date")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.start_week,expression:"form.start_week"}],staticClass:"form-control",attrs:{type:"number",id:"formStartWeek",min:"0",max:e.total_weeks,readonly:e.loading},domProps:{value:e.form.start_week},on:{input:function(t){t.target.composing||(e.form.start_week=t.target.value)}}}),e._v(" "),r("small",{staticClass:"form-text text-muted"},[e._v("The week of the year only (0 - 50)")])])]),e._v(" "),r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formEndWeek"}},[e._v("End Date")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.end_week,expression:"form.end_week"}],staticClass:"form-control",attrs:{type:"number",id:"formEndWeek",min:"0",max:e.total_weeks,readonly:e.loading},domProps:{value:e.form.end_week},on:{input:function(t){t.target.composing||(e.form.end_week=t.target.value)}}}),e._v(" "),r("small",{staticClass:"form-text text-muted"},[e._v("Leave zero for unlimited length, the week number (0 - 50)")])])]),e._v(" "),r("div",{staticClass:"w-100"}),e._v(" "),r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formRuleType"}},[e._v("Rule Type")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.form.type,expression:"form.type"}],staticClass:"form-control",attrs:{id:"formRuleType",readonly:e.loading},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.form.type=t.target.multiple?r:r[0]}}},e._l(e.types,function(t){return r("option",{domProps:{value:t.id}},[e._v(e._s(t.id))])}))])]),e._v(" "),"day_of_week"==e.form.type?r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formDay"}},[e._v("Day of week")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.form.value.day,expression:"form.value.day"}],staticClass:"form-control",attrs:{id:"formDay",readonly:e.loading},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.form.value.day=t.target.multiple?r:r[0]}}},[r("option",{attrs:{value:"MON"}},[e._v("MON")]),e._v(" "),r("option",{attrs:{value:"TUE"}},[e._v("TUE")]),e._v(" "),r("option",{attrs:{value:"WED"}},[e._v("WED")]),e._v(" "),r("option",{attrs:{value:"THU"}},[e._v("THU")]),e._v(" "),r("option",{attrs:{value:"FRI"}},[e._v("FRI")])])])]):e._e(),e._v(" "),"time_of_day"===e.form.type?r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formTime"}},[e._v("Start Time")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.value.time,expression:"form.value.time"}],staticClass:"form-control",attrs:{type:"text",id:"formTime",readonly:e.loading},domProps:{value:e.form.value.time},on:{input:function(t){t.target.composing||(e.form.value.time=t.target.value)}}})])]):e._e(),e._v(" "),"time_of_day"===e.form.type?r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formDuration"}},[e._v("Duration")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.form.value.duration,expression:"form.value.duration"}],staticClass:"form-control",attrs:{type:"text",id:"formDuration",readonly:e.loading},domProps:{value:e.form.value.duration},on:{input:function(t){t.target.composing||(e.form.value.duration=t.target.value)}}})])]):e._e(),e._v(" "),"status"===e.form.type?r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formStatus"}},[e._v("Status")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.form.value.status_id,expression:"form.value.status_id"}],staticClass:"form-control",attrs:{id:"formStatus",readonly:e.loading},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.form.value.status_id=t.target.multiple?r:r[0]}}},e._l(e.statuses,function(t){return r("option",{domProps:{value:t.id}},[e._v(e._s(t.name))])}))])]):e._e(),e._v(" "),"location"===e.form.type?r("div",{staticClass:"col"},[r("div",{staticClass:"form-group"},[r("label",{attrs:{for:"formStatus"}},[e._v("Location")]),e._v(" "),r("select",{directives:[{name:"model",rawName:"v-model",value:e.form.value.location_id,expression:"form.value.location_id"}],staticClass:"form-control",attrs:{id:"formLocation",readonly:e.loading},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.form.value.location_id=t.target.multiple?r:r[0]}}},e._l(e.locations,function(t){return r("option",{domProps:{value:t.id}},[e._v(e._s(t.name))])}))])]):e._e()]),e._v(" "),r("div",{staticClass:"text-center"},[r("button",{staticClass:"btn btn-primary",attrs:{type:"submit",disabled:e.loading}},[e._v("Add")]),e._v(" "),r("button",{staticClass:"btn btn-secondary",attrs:{type:"button",disabled:e.loading},on:{click:e.reset}},[e._v("Reset Form")])])])])]),e._v(" "),r("transition-group",{attrs:{tag:"div",name:"slide-rev"}},e._l(e.notes,function(t,n){return r("div",{key:n,staticClass:"alert alert-info mb-1"},[e._v(e._s(t))])}))],2)},o=[],a={render:n,staticRenderFns:o};t.a=a}},["NHnr"]);
//# sourceMappingURL=app.e55e5c07dbf3aa5a7f5d.js.map